# CLAUDE.md

本文档为 AI 助手在 noteapp 代码库中工作提供指导。

## 项目概述

**noteapp** 是一款移动端语音笔记应用，让用户通过语音快速记录并自动转换为文本。采用本地优先架构，保护用户隐私。

- **核心价值**：语音记录 + 本地存储 + 隐私保护
- **目标平台**：iOS / Android
- **开发周期**：4 周

### 当前状态

**M1 里程碑已完成**：应用骨架已搭建，导航正常运行。

- 项目已初始化（Expo + TypeScript）
- 底部 Tab 导航已配置
- UI 组件库已集成（React Native Paper）
- 数据库已配置（expo-sqlite）
- 基础页面已创建（首页、录音、设置、详情页）

## 仓库结构

```
noteapp/
├── app/                    # Expo Router 页面
│   ├── (tabs)/             # Tab 导航页面
│   │   ├── _layout.tsx     # Tab 导航配置
│   │   ├── index.tsx       # 首页（笔记列表）
│   │   ├── record.tsx      # 录音页
│   │   └── settings.tsx    # 设置页
│   ├── note/
│   │   └── [id].tsx        # 笔记详情页
│   └── _layout.tsx         # 根布局
├── src/
│   ├── db/
│   │   └── database.ts     # SQLite 数据库配置
│   ├── store/
│   │   └── noteStore.ts    # Zustand 状态管理
│   └── types/
│       └── note.ts         # TypeScript 类型定义
├── assets/                 # 静态资源
├── app.json               # Expo 配置
├── package.json           # 依赖配置
├── tsconfig.json          # TypeScript 配置
├── CLAUDE.md              # AI 助手指南（本文件）
├── MVP_DESIGN.md          # MVP 设计文档
└── README.md              # 项目描述
```

## 技术栈

| 类别 | 选择 |
|------|------|
| 框架 | React Native + Expo |
| 语言 | TypeScript |
| 状态管理 | Zustand |
| 本地存储 | expo-sqlite |
| 语音识别 | @react-native-voice/voice |
| UI 组件 | React Native Paper |
| 导航 | Expo Router |

## 数据模型

```typescript
interface Note {
  id: string;          // UUID
  content: string;     // 笔记内容
  createdAt: number;   // 创建时间戳
  updatedAt: number;   // 更新时间戳
  wordCount: number;   // 字数
}
```

## MVP 核心功能（仅 3 个）

| 功能 | 描述 | 验收标准 |
|------|------|----------|
| **语音录制与转文字** | 点击录音，实时转文字，自动保存 | 语音能转为文字并保存 |
| **笔记管理** | 查看列表、查看详情、删除（不含编辑） | 列表显示、详情查看、删除确认 |
| **本地存储** | SQLite 本地存储，无云端上传 | 关闭应用后数据保留 |

### 不在 MVP 范围

- 标签系统
- 搜索功能
- 笔记编辑
- 云同步 / 用户账号
- 音频文件保存
- 深色模式

## 页面结构

- **首页**：笔记列表（按时间倒序）
- **录音页**：麦克风按钮 + 实时转写显示
- **详情页**：笔记内容 + 删除按钮

底部 Tab 导航：首页 | 录音 | 设置（预留）

## 构建和开发命令

```bash
# 安装依赖
npm install

# 运行开发服务器（Expo）
npx expo start

# 运行 iOS 模拟器
npx expo run:ios

# 运行 Android 模拟器
npx expo run:android

# 运行测试
npm test

# 代码检查
npm run lint

# 构建生产版本（EAS Build）
eas build --platform all
```

## 开发计划（4 周）

| 周次 | 目标 | 交付物 |
|------|------|--------|
| 第 1 周 | 项目搭建 | Expo 项目初始化、导航配置、UI 组件库、数据库配置 |
| 第 2 周 | 笔记管理 | 笔记列表、详情页、删除功能、数据持久化 |
| 第 3 周 | 语音功能 | 语音识别集成、录音界面、实时转写、自动保存 |
| 第 4 周 | 测试发布 | 双平台测试、Bug 修复、提交应用商店 |

### 里程碑

| 里程碑 | 时间 | 验收标准 | 状态 |
|--------|------|----------|------|
| M1 | 第 1 周 | 应用骨架运行，导航正常 | ✅ 已完成 |
| M2 | 第 2 周 | 笔记 CRUD 功能可用 | 🔲 待开始 |
| M3 | 第 3 周 | 语音转文字并保存成功 | 🔲 待开始 |
| M4 | 第 4 周 | 提交至应用商店 | 🔲 待开始 |

## 代码规范

### 基本原则
- 编写清晰、自文档化的代码
- 保持函数小巧并专注于单一职责
- 使用有意义的变量和函数名称
- 仅为不易理解的复杂逻辑添加注释

### 文件组织
- 按功能或领域对相关文件进行分组
- 将配置文件保留在项目根目录
- 将源代码放在 `src/` 或 `app/` 目录中（Expo Router 使用 `app/`）
- 将测试文件放在源文件旁边或 `__tests__` 目录中

### 提交信息
- 使用祈使语气（"添加功能" 而非 "添加了功能"）
- 第一行保持在 72 个字符以内
- 需要时在正文中包含上下文说明

## 测试策略

推荐方法：
- 核心逻辑的单元测试
- 音频/语音功能的集成测试
- 关键用户流程的端到端测试

## 特别注意事项

### 音频/语音功能
- 优雅地处理麦克风权限
- 在录制期间提供视觉反馈
- 使用系统语音识别 API（iOS: Apple Speech, Android: Google Speech）

### 隐私和安全
- 笔记数据仅存储在设备本地
- 语音识别使用系统 API
- 首次使用需告知用户语音数据会发送至系统服务器

### 无障碍访问
- 为音频反馈提供视觉替代方案
- 支持键盘导航
- 确保屏幕阅读器兼容性

## AI 助手指南

在处理此代码库时：

1. **理解上下文**：在进行更改之前阅读相关文件
2. **最小化更改**：仅进行完成任务所必需的更改
3. **避免过度工程**：不添加未请求的功能或抽象
4. **遵循 MVP 范围**：不实现 MVP 范围外的功能
5. **测试更改**：如有测试可用，在提交前运行测试
6. **清晰的提交**：编写描述性的提交信息，解释"为什么"

### 常见任务

- **添加新功能**：创建必要的文件，更新导入，添加测试
- **修复错误**：识别根本原因，进行最小修复，通过测试验证
- **重构**：确保更改前后测试都能通过

## 发布

- **构建**：Expo EAS Build
- **iOS**：Apple Developer ($99/年) → App Store Connect
- **Android**：Google Play Developer ($25) → Play Console
